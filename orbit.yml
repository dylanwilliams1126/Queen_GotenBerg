tasks:

  - use: install
    short: Installs all required dev dependencies
    run:
      - go get -u github.com/golang/dep/cmd/dep
      - go get -u gopkg.in/alecthomas/gometalinter.v2
      - gometalinter.v2 --install

  - use: lint
    short: Formats the code and statically checks for errors and warnings
    run:
      - go fmt ./...
      - gometalinter.v2 --disable-all -E vet -E gofmt -E misspell -E ineffassign -E goimports -E deadcode -E gocyclo --vendor ./...

  - use: tests
    short: Runs tests inside a container
    run:
      - docker build -t gotenberg:tests -f Dockerfile.tests .
      - docker run --rm gotenberg:tests

  - use: build
    short: Builds a Linux binary and the Docker image
    run:
      - env GOOS=linux GOARCH=amd64 CGO_ENABLED=0 go build -ldflags "-X main.version={{ .Orbit.Version }}"
      - docker build . -t gotenberg:{{ .Orbit.Version }}

  - use: up
    short: Starts the {{ .Orbit.Version }} version of the Gotenberg image
    run:
      - docker run --rm -p 3000:3000/tcp gotenberg:{{ .Orbit.Version }}